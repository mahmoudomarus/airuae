generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String     @id
  email        String     @unique
  password     String?    @map("passwordHash")
  firstName    String?
  lastName     String?
  profileImage String?
  phone        String?
  isVerified   Boolean    @default(false)
  role         UserRole   @default(USER)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime

  // Optional Stripe Customer ID
  stripeCustomerId String?

  // Relations
  properties Property[] @relation("PropertyOwner")
  bookings   Booking[]  @relation("BookingUser")

  @@map("User")
}

enum UserRole {
  USER
  AGENT
  LANDLORD
  ADMIN

  @@map("UserRole")
}

model Property {
  id          String   @id
  title       String
  description String?
  address     String
  city        String
  country     String
  zipCode     String?
  price       Float
  bedrooms    Int
  bathrooms   Int
  size        Float?
  available   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  // Geo location
  latitude  Float?
  longitude Float?

  // Owner (One-to-Many relation)
  owner   User   @relation("PropertyOwner", fields: [ownerId], references: [id])
  ownerId String

  // Arrays
  images    String[]
  amenities String[]

  // Relations
  bookings Booking[] @relation("PropertyBookings")

  @@map("Property")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED

  @@map("BookingStatus")
}

model Booking {
  id         String        @id
  startDate  DateTime
  endDate    DateTime
  totalPrice Float
  nights     Int
  status     BookingStatus @default(PENDING)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime

  // Payment information
  paymentIntentId String?
  paymentStatus   String?
  paymentMethod   String?
  isPaid          Boolean  @default(false)

  // User (One-to-Many relation)
  user   User   @relation("BookingUser", fields: [userId], references: [id])
  userId String

  // Property (One-to-Many relation)
  property   Property @relation("PropertyBookings", fields: [propertyId], references: [id])
  propertyId String

  @@map("Booking")
}
